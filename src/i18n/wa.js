/**
 * WhatsApp akışı mesajları. Tek dil seçilir (işletme ayarı whatsapp_lang).
 * getWaT(lang) ile metin alınır; employee_selection_label işletme ayarından gelir.
 */
const messages = {
  tr: {
    welcome_body: 'Ne yapmak istersiniz?',
    welcome_btn_appointment: 'Randevu al',
    welcome_btn_queue: 'Sıraya gir',
    welcome_btn_cancel: 'İptal',
    date_select_body: 'Hangi gün?',
    date_select_button: 'Tarih seç',
    date_section_title: 'Tarih',
    employee_select_body: 'Hangi çalışan?',
    employee_select_button: 'Çalışan seç',
    employees_section_title: 'Çalışanlar',
    time_select_body: 'Hangi saat?',
    time_select_button: 'Saat seç',
    time_section_title: 'Müsait saatler',
    time_select_no_slots: 'Bu gün için müsait saat bulunamadı. Lütfen başka bir gün veya çalışan seçin.',
    confirm_btn_confirm: 'Onayla',
    confirm_btn_back: 'Geri',
    confirm_btn_back_employee: 'Çalışan seçimine dön',
    confirm_btn_back_date: 'Gün seçimine dön',
    confirm_btn_back_time: 'Saat seçimine dön',
    confirm_btn_cancel: 'İptal et',
    confirm_list_button: 'Seçin',
    confirm_summary_prefix: 'Randevu özeti:',
    confirm_summary_day: 'Gün',
    confirm_summary_employee: 'Çalışan',
    confirm_summary_time: 'Saat',
    confirm_summary_question: 'Onaylıyor musunuz?',
    queue_confirm_body: 'Sıraya ekleniyorsunuz. Onaylıyor musunuz?',
    queue_btn_confirm: 'Onayla',
    queue_btn_cancel: 'İptal',
    cancelled_message: 'İşlem iptal edildi. Tekrar yazarsanız menü açılır.',
    appointment_approved: 'Randevunuz onaylandı.',
    appointment_pending: 'Talebiniz onaya gönderildi. Onaylandığında size bildirilecektir.',
    queue_result_prefix: 'Sıraya eklendiniz.',
    queue_result_position: 'Sıra numaranız:',
    queue_result_suffix: "Sıradan çıkmak için 'İptal' yazabilirsiniz.",
    slot_unavailable: 'Bu slot artık müsait değil. Lütfen başka bir saat seçin.',
    existing_same_day: 'Bu gün için zaten bir randevunuz var (web veya WhatsApp). Başka bir gün seçebilirsiniz.',
    appointment_approved_notify: 'Randevunuz onaylandı.',
    appointment_rejected_notify: 'Talebiniz reddedildi. İsterseniz yeniden randevu alabilirsiniz.',
    date_today: 'Bugün',
    date_tomorrow: 'Yarın',
    date_days_later: (n) => `${n} gün sonra`,
    no_employees: 'Şu an randevu alınabilecek çalışan yok.',
    invalid_selection: 'Seçeneklerden birini seçin.',
    timeout_message: 'Zaman aşımı oldu, menüye dönüyorum.',
    help_text: 'Komutlar: iptal / menü / baştan = menüye dön. geri = bir önceki adım. randevularım = randevularım.',
    welcome_btn_my_appointments: 'Randevularım',
    welcome_btn_help: 'Yardım',
    welcome_list_button: 'Seçin',
    welcome_menu_section_title: 'Menü',
    no_slots_btn_other_day: 'Başka gün seç',
    no_slots_btn_other_employee: 'Başka çalışan seç',
    no_slots_btn_menu: 'Menü',
    same_day_btn_my_appointments: 'Randevularım',
    same_day_btn_other_day: 'Başka gün seç',
    same_day_btn_menu: 'Menü',
    my_appointments_no: 'Aktif randevunuz bulunmuyor.',
    my_appointments_body: 'Randevuyu seçin.',
    my_appointments_section_title: 'Randevularınız',
    my_appointments_list_button: 'Randevu seç',
    my_appointments_action_body: 'Ne yapmak istersiniz?',
    appointment_action_cancel: 'İptal et',
    appointment_action_keep: 'Sakla',
    appointment_action_exit: 'Başa dön',
    confirm_cancel_appointment_body: 'Bu randevuyu iptal etmek istediğinize emin misiniz?',
    confirm_cancel_btn_confirm: 'Evet, iptal et',
    confirm_cancel_btn_back: 'Vazgeç',
    appointment_cancelled_success: 'Randevunuz iptal edildi.',
    cancel_already: 'Bu randevu zaten iptal edilmiş.',
    cancel_past: 'Geçmiş randevular iptal edilemez.',
    cancel_too_close: 'Randevuya çok az kaldığı için iptal edilemiyor.',
  },
  en: {
    welcome_body: 'What would you like to do?',
    welcome_btn_appointment: 'Book appointment',
    welcome_btn_queue: 'Join queue',
    welcome_btn_cancel: 'Cancel',
    date_select_body: 'Which day?',
    date_select_button: 'Select date',
    date_section_title: 'Date',
    employee_select_body: 'Which staff?',
    employee_select_button: 'Select staff',
    employees_section_title: 'Staff',
    time_select_body: 'Which time?',
    time_select_button: 'Select time',
    time_section_title: 'Available times',
    time_select_no_slots: 'No available times for this day. Please choose another day or staff member.',
    confirm_btn_confirm: 'Confirm',
    confirm_btn_back: 'Back',
    confirm_btn_back_employee: 'Back to staff selection',
    confirm_btn_back_date: 'Back to date selection',
    confirm_btn_back_time: 'Back to time selection',
    confirm_btn_cancel: 'Cancel',
    confirm_list_button: 'Select',
    confirm_summary_prefix: 'Appointment summary:',
    confirm_summary_day: 'Day',
    confirm_summary_employee: 'Staff',
    confirm_summary_time: 'Time',
    confirm_summary_question: 'Do you confirm?',
    queue_confirm_body: 'You are joining the queue. Do you confirm?',
    queue_btn_confirm: 'Confirm',
    queue_btn_cancel: 'Cancel',
    cancelled_message: 'Cancelled. Send a message to see the menu again.',
    appointment_approved: 'Your appointment has been confirmed.',
    appointment_pending: 'Your request has been submitted. You will be notified when it is confirmed.',
    queue_result_prefix: 'You have been added to the queue.',
    queue_result_position: 'Your queue number:',
    queue_result_suffix: "To leave the queue, type 'Cancel'.",
    slot_unavailable: 'This slot is no longer available. Please choose another time.',
    existing_same_day: 'You already have an appointment on this day (web or WhatsApp). Please choose another day.',
    appointment_approved_notify: 'Your appointment has been confirmed.',
    appointment_rejected_notify: 'Your request was declined. You can book again if you wish.',
    date_today: 'Today',
    date_tomorrow: 'Tomorrow',
    date_days_later: (n) => `${n} days from now`,
    no_employees: 'There are no staff available for appointments at the moment.',
    invalid_selection: 'Please choose one of the options.',
    timeout_message: 'Session timed out, returning to menu.',
    help_text: 'Commands: cancel / menu / start over = back to menu. back = previous step. my appointments = my appointments.',
    welcome_btn_my_appointments: 'My appointments',
    welcome_btn_help: 'Help',
    welcome_list_button: 'Select',
    welcome_menu_section_title: 'Menu',
    no_slots_btn_other_day: 'Choose another day',
    no_slots_btn_other_employee: 'Choose another staff',
    no_slots_btn_menu: 'Menu',
    same_day_btn_my_appointments: 'My appointments',
    same_day_btn_other_day: 'Choose another day',
    same_day_btn_menu: 'Menu',
    my_appointments_no: 'You have no upcoming appointments.',
    my_appointments_body: 'Select appointment.',
    my_appointments_section_title: 'Your appointments',
    my_appointments_list_button: 'Select appointment',
    my_appointments_action_body: 'What would you like to do?',
    appointment_action_cancel: 'Cancel appointment',
    appointment_action_keep: 'Keep',
    appointment_action_exit: 'Back to menu',
    confirm_cancel_appointment_body: 'Are you sure you want to cancel this appointment?',
    confirm_cancel_btn_confirm: 'Yes, cancel',
    confirm_cancel_btn_back: 'No, keep it',
    appointment_cancelled_success: 'Your appointment has been cancelled.',
    cancel_already: 'This appointment is already cancelled.',
    cancel_past: 'Past appointments cannot be cancelled.',
    cancel_too_close: 'Cannot cancel; appointment is too soon.',
  },
};

const FALLBACK_LANG = 'tr';

/**
 * @param {string} lang - 'tr' | 'en'
 * @returns {(key: string, ...args: unknown[]) => string}
 */
function getWaT(lang) {
  const L = messages[lang] || messages[FALLBACK_LANG];
  return function (key, ...args) {
    const val = L[key] ?? messages[FALLBACK_LANG][key];
    if (typeof val === 'function') return val(...args);
    return typeof val === 'string' ? val : key;
  };
}

/** Panel için kullanılabilir WhatsApp dilleri */
const AVAILABLE_LANGUAGES = [
  { code: 'tr', name: 'Türkçe' },
  { code: 'en', name: 'English' },
];

function getAvailableLanguages() {
  return AVAILABLE_LANGUAGES;
}

module.exports = {
  messages,
  getWaT,
  getAvailableLanguages,
  FALLBACK_LANG,
};
